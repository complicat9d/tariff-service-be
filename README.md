# README документация для проекта

Этот проект реализует REST API для расчёта стоимости страхования в зависимости от типа груза и объявленной стоимости (ОС). Тарифы для расчёта загружаются из файла JSON или могут быть переданы в JSON-формате через API. В ответ сервис возвращает стоимость страховки, которая рассчитывается как произведение объявленной стоимости на ставку тарифа.

## Описание функционала

1. **Загрузка тарифов** — тарифы для различных типов грузов и дат загружаются через API, либо могут быть переданы в виде файла JSON. Каждый тариф содержит дату, тип груза и ставку (rate).
2. **Расчёт стоимости страховки** — сервис принимает запрос с типом груза, датой и объявленной стоимостью, затем использует актуальный тариф для расчёта (объявленная стоимость умножается на ставку тарифа).
3. **Управление тарифами** — сервис поддерживает функции создания, редактирования и удаления тарифов.
4. **Логирование** — все изменения тарифов, а также запросы на расчёт стоимости, логируются с использованием Kafka. Логи содержат информацию о действии, ID пользователя, типе груза и времени события.
5. **Хранение данных** — тарифы и данные о пользователях хранятся в базе данных PostgreSQL.
6. **Docker** — проект поддерживает развёртывание внутри Docker с использованием Docker Compose для работы с PostgreSQL.


## Развёртывание в Docker






## Логирование

Все действия пользователей (создание, обновление, удаление тарифов), а также запросы на расчёт стоимости, логируются в Kafka с дополнительной информацией:

- ID пользователя (если доступно)
- Тип действия (создание, обновление, удаление тарифа, расчёт стоимости и т. д.)
- Время события

Это позволяет отслеживать все изменения и события в системе.




## Описание эндпоинтов

### Пользователи

#### 1. Создание пользователя

**POST /api/user/create**

Создает нового пользователя в системе и возвращает токен доступа.

**Тело запроса:**
```json
{
  "username": "user@example.com",
  "password": "securepassword"
}
```

**Ответ:**
```json
{
  "access_token": "your_jwt_token"
}
```

#### 2. Авторизация пользователя

**POST /api/user/login**

Авторизует пользователя и возвращает JWT токен.

**Тело запроса:**
```json
{
  "username": "user@example.com",
  "password": "securepassword"
}
```

**Ответ:**
```json
{
  "access_token": "your_jwt_token"
}
```

### Тарифы

#### 1. Создание тарифа

**POST /api/tariff**

Создает новый тариф для указанной даты и типа груза. Если тариф с такими параметрами уже существует, вернется предупреждение.

**Тело запроса:**
```json
{
  "date": "2024-11-23",
  "cargo_type": "cargo_type_example",
  "rate": 10.5
}
```

**Ответ:**
```json
{
  "date": "2024-11-23",
  "cargo_type": "cargo_type_example",
  "rate": 10.5
}
```

#### 2. Обновление тарифа

**PUT /api/tariff**

Обновляет тариф для указанной даты и типа груза.

**Тело запроса:**
```json
{
  "date": "2024-11-23",
  "cargo_type": "cargo_type_example",
  "rate": 12.0
}
```

**Ответ:**
```json
{
  "date": "2024-11-23",
  "cargo_type": "cargo_type_example",
  "rate": 12.0
}
```

#### 3. Удаление тарифа

**DELETE /api/tariff**

Удаляет тариф для указанной даты и типа груза.

**Тело запроса:**
```json
{
  "date": "2024-11-23",
  "cargo_type": "cargo_type_example"
}
```

**Ответ:**  
Возвращает статус **200 OK** при успешном удалении.

#### 4. Расчёт стоимости страховки

**POST /api/tariff/calculate**

Вычисляет стоимость страховки на основе тарифа для заданной даты и типа груза.

**Тело запроса:**
```json
{
  "date": "2024-11-23",
  "cargo_type": "cargo_type_example",
  "value": 1000
}
```

**Ответ:**
```json
{
  "insurance_cost": 10500
}
```

#### 5. Получение всех тарифов

**GET /api/tariff**

Получает список всех тарифов с пагинацией.

**Ответ:**
```json
[
  {
    "date": "2024-11-23",
    "cargo_type": "cargo_type_example",
    "rate": 10.5
  },
  ...
]
```

#### 6. Загрузка тарифов из файла

**POST /api/tariff/upload**

Загружает тарифы из файла JSON. Каждый объект тарифа должен содержать дату, тип груза и ставку.

**Формат файла:**
```json
{
  "2024-11-23": {
    "cargo_type": "cargo_type_example",
    "rate": 10.5
  },
  "2024-11-24": {
    "cargo_type": "cargo_type_example",
    "rate": 12.0
  }
}
```

**Ответ:**
Возвращает статус **201 Created** при успешной загрузке.
